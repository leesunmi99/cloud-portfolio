

CI/CD 파이프라인 구성시 고려해야 하는 사항




Jenkins Pipeline 구성 여부


이전까지 구성했던 것은 각각의 파이프라인을 따로 실행했던 것인데, 

Jenkins Pipeline을 이용해 한번에 연결되는 구조를 만들 수도 있다. 

일반적으로 한번에 구성하는 것이 기능적으로는 좋지만, 실무에서는 관리 담당자의 역할을 구분하거나, 처음부터 기능을 만드는 경우에는 분리하는 것이 관리 책임 면에서 좋다. 

(어차피 트리거를 걸어놓으면 자동 배포가 되는 것은 마찬가지)



혹은 소스빌드( 개발자) / 컨테이너 빌드. 배포 (Devops 엔지니어) 로 구분할 수도 있다. 

=> 기능적 / 관리적 측면을 고려해 무엇이 효율적인지 고려해야 함







ArgoCD 사용 




배포: 인프라 환경

1:N 

장점: 편의성 / 단점: 개발 환경에 장애시 운영환경에도 배포 불가

1:1

장점: 개발 환경 장애시에도 지장 없음 / 단점: ArgoCD 이중 관리 부담

(후자를 더 많이 사용한다)

=> 회사마다 관리 편/장애 영향도 어떤 것을 중시할지에 따라 다르다. 







CI/CD 툴

온라인: Github Actions 

오프라인: Jenkins, JenkinsX(컨테이너 친화), Tekton(컨테이너 친화)

CI 전용 툴

온라인: Travis CI, Circleci

오프라인: GitLab

CD 전용 툴

오프라인: argoCD, Spinnaker

금융권, 의료기관, 공공기관들은 자사의 시스템이 인터넷 상에 있으면 안되기 때문에 오프라인 툴을 사용해야 한다. 

=> 레퍼런스가 많은 것을 선택하기 

Github Actions > Jenkins >>> ArgoCD

(국내에서는 Github Actions < Jenkins)

제품을 도입하고 유지보수하는 것도 고려해야함 





Docker의 대체

Docker의 단점

1. 무겁다(자원을 많이 사용함)

2. Deamon이 필요하다

(컨테이너 빌드 속도가 느린 것은 아님)


도커로 컨테이너를 여러 개 띄웠는데 도커 데몬이 죽으면 모든 컨테이너가 같이 다운 됨

CI/CD에서 컨테이너 빌드용으로만 사용하면 문제 되지 않음

CI/CD 서버에서는 컨테이너를 띄워놓을 일이 없다



=> 자원 사용량이 중요하면 buildah+podman+skopeo+argoCD 고려(Openshift같은 관리형 k8s 제품에 기본적으로 포함됨)

buildah: 컨테이너 빌드(Deamoless)

podman: docker 로그인 및 이미지 가져오기

skopeo: 이미지 푸시 









배포 전략을 세울 때 고려해야 하는 요소


1. Recreate


- 배포 작업

: Deployment 업데이트

- 특징









2. RollingUpdate


- 배포 작업

: Deployment 업데이트

- 특징



- ⚠️단점











3. Blue/green

- 배포 작업

1. v2 버전의 Deployment 생성

2. Service의 selector를 v1->v2로 수정

3. v1 버전의 Deployment 삭제

- 특징

수동 배포시 롤백이 빠름

Script를 통해 자동 배포 가능

- ⚠️단점

v2에 과도한 트래픽 유입시 문제 발생





기존 운영 환경에서 배포해왔던 방식

L4 네트워크 장비 - VM1

                           - VM2

이중화 시켜서 사용

- 배포 작업

1. VM2의 연결 해제

2. VM2에 소스 패치 밒 기동 설정 
3. L4 담당자가 트래픽 변환

이때, V1을 먼저 끊고 V2를 연결 -> Recreate

V2를 먼저 연결하고 V1을 해제 -> RollingUpdate

보통 VM1을 끊음과 동시에 V2를 연결함

이후 VM1도 패치 후 다시 이중화 구성

=> 현재는 kubernetes 사용으로 네트워크단 장비를 건드리지 않고 Blue/Green 배포가 가능하다. 

















